#!/bin/bash

ENTRYPOINT=""
CMD=/bin/bash
FALLBACK_CMD=/bin/sh
if [ "$1" = "-e" ]; then
  ENTRYPOINT="--entrypoint /bin/sh"
  CMD=""
  shift
elif [ "$1" = "--" ]; then
  shift
  CMD="$@"
fi

IDS="$(docker images | peco | awk '{print $3}')"
for id in $IDS; do
  # if sudo docker exec --rm -t -i ${CONTAINER} sh -c "builtin type bash" >/dev/null 2>&1; then
  #   echo sudo docker run --rm -t "$@" -i $id /bin/bash
  #   sudo docker run --rm -t "$@" -i $id /bin/bash
  # else
  # fi
  echo sudo docker run $ENTRYPOINT --rm -t "$@" -i $id $CMD
  sudo docker run $ENTRYPOINT --rm -t "$@" -i $id $CMD \
  || sudo docker run $ENTRYPOINT --rm -t "$@" -i $id $FALLBACK_CMD
done

