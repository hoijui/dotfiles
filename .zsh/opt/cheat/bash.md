## 置換

| パターン                       | 動作                                 | 典型的な使用例        |
|--------------------------------|--------------------------------------|-----------------------|
| ${変数%マッチパターン}         | 後方からの検索で最短マッチ部分を削除 | ${HOGE%/*}でdirname   |
| ${変数%%マッチパターン}        | 後方からの検索で最長マッチ部分を削除 | あまり使わない        |
| ${変数#マッチパターン}         | 前方からの検索で最短マッチ部分を削除 | あまり使わない        |
| ${変数##マッチパターン}        | 前方からの検索で最長マッチ部分を削除 | ${HOGE##*/}でbasename |
| ${変数/検索文字列/置換文字列}  | 最初にマッチしたもののみ文字列を置換 |                       |
| ${変数//検索文字列/置換文字列} | 全ての文字列を置換                   | ${HOGE//foo/bar}      |

## Bashで自身の関数名と呼び出し元の関数名を取得
- https://qiita.com/koara-local/items/5e3fd1d0c9080ea61b5b

```
local fn=${FUNCNAME[0]}
local caller=${FUNCNAME[1]} # 呼び出し元の関数名
```

## logger

```bash
exec 1> >(logger -s -t $(basename $0)) 2>&1
exec > >(tee log.log) 2>&1
# 標準出力をリダイレクト
exec > log.log
# 標準エラーを標準出力に
exec 2>&1
```

## 行を逆順に変換

```
cat file | rev | tac | rev | command
```

## ROOTかどうかをチェックする

```
if [ ${EUID:-${UID}} = 0 ]; then
    echo 'I am root.'
fi
if [ `whoami` = 'root' ]; then
    echo 'I am root.'
fi
if [ $UID = `id -u root` ]; then
    echo 'I am root.'
fi
if [ $(id -u) = $(id -u root) ]; then
    echo 'I am root.'
fi
```



## 配列・ハッシュ

```bash
declare -a array=(1 2 3)
declare -A H
H["key1"]="value1"
H["key2"]="value2"
H["key3"]="value3"

H=( \
  ["key1"]="value1" \
  ["key2"]="value2" \
  ["key3"]="value3"
)

for i in ${!H[@]}; do
  echo "${i} => [${H[$i]}]"
done
```

## 変数名で変数参照

```bash
eval echo '$'$hoge
```


## 大文字・小文字変換

```
## toUpperCase
tr a-z A-Z
## toLowerCase
tr A-Z a-z
```

## 一行ずつ処理

```bash
cat file | while read line ; do
  #
done
```

## コマンド結果をファイル名引数に

```
diff <(cmd1) <(cmd2)
diff <(ssh host1 cat /etc/hosts) <(ssh host2 cat /etc/hosts)
```

## 特殊変数
### 最初の引数
`!^`
### 最後の引数
`!$`
### 指定の引数(n番目)
`!:n`
### すべての引数
`!*`

## 実行したコマンド自体を利用する
### 直前に実行したコマンド
`!!`
### コマンド履歴を検索して、最初にヒットしたコマンド
`!hoge`
### 直前に実行したコマンドのfooをbarにして実行
`!:s/foo/bar`

## パスを利用する
### 拡張子を除いたパスを取得
`!$:r`
### 拡張子だけを取得
`!$:e`
### パスのディレクトリ部分を取得
`!^:h`
### ファイル名だけを取得
`!^:t`

## スクリプトで使用する特殊変数

- `$?` 	直前に実行されたコマンドの終了ステータスが設定される変数。
- `$!` 	バックグラウンドで実行されたコマンドのプロセスID が設定される変数。
- `$-` 	set コマンドで設定されたフラグ、もしくはシェルの起動時に指定されたフラグの一覧が設定される変数。
- `$$` 	コマンド自身の PID (プロセスID)が設定される変数。シェルスクリプト内の場合はシェルスクリプトのPIDが取得できる。
- `$#` 	実行時に指定された引数の数が設定される変数。
- `$@` 	シェルスクリプト実行時、もしくは set コマンド実行時に指定された全パラメータが設定される変数。`$*` と基本的に同じだが""で囲んだときの動作が異なる。
- `$*` 	シェルスクリプト実行時、もしくは set コマンド実行時に指定された全パラメータが設定される変数。`$@` と基本的に同じだが""で囲んだときの動作が異なる。
- `$LINENO` 	この変数を使用している行の行番号が設定される変数。
- `${PIPESTATUS[@]}` 	パイプで連結した各コマンドの終了ステータスが設定される変数(配列)。パイプ(「|」)により連結された各コマンドの終了ステータスが設定設定されている変数(配列)。

